<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 1.2.0">
<meta name="crystal_docs.project_version" content="0.7.0">
<meta name="crystal_docs.project_name" content="email">



<link href="css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/doc.js"></script>

  <meta name="repository-name" content="email">
  <title>email 0.7.0</title>
  <script type="text/javascript">
  CrystalDocs.base_path = "";
  </script>
</head>
<body>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>
<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="index.html">
          email
        </a>
      </h1>

      <span class="project-version">
        0.7.0
      </span>
    </div>
  </div>

  <div class="search-results hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent " data-id="email/EMail" data-name="email">
      <a href="EMail.html">EMail</a>
      
        <ul>
  
  <li class="parent " data-id="email/EMail/Client" data-name="email::client">
      <a href="EMail/Client.html">Client</a>
      
        <ul>
  
  <li class=" " data-id="email/EMail/Client/Config" data-name="email::client::config">
      <a href="EMail/Client/Config.html">Config</a>
      
    </li>
  
  <li class=" " data-id="email/EMail/Client/OnFailedProc" data-name="email::client::onfailedproc">
      <a href="EMail/Client/OnFailedProc.html">OnFailedProc</a>
      
    </li>
  
  <li class=" " data-id="email/EMail/Client/OnFatalErrorProc" data-name="email::client::onfatalerrorproc">
      <a href="EMail/Client/OnFatalErrorProc.html">OnFatalErrorProc</a>
      
    </li>
  
  <li class=" " data-id="email/EMail/Client/TLSMode" data-name="email::client::tlsmode">
      <a href="EMail/Client/TLSMode.html">TLSMode</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="email/EMail/ConcurrentSender" data-name="email::concurrentsender">
      <a href="EMail/ConcurrentSender.html">ConcurrentSender</a>
      
    </li>
  
  <li class="parent " data-id="email/EMail/Error" data-name="email::error">
      <a href="EMail/Error.html">Error</a>
      
        <ul>
  
  <li class=" " data-id="email/EMail/Error/AddressError" data-name="email::error::addresserror">
      <a href="EMail/Error/AddressError.html">AddressError</a>
      
    </li>
  
  <li class=" " data-id="email/EMail/Error/ClientConfigError" data-name="email::error::clientconfigerror">
      <a href="EMail/Error/ClientConfigError.html">ClientConfigError</a>
      
    </li>
  
  <li class=" " data-id="email/EMail/Error/ClientError" data-name="email::error::clienterror">
      <a href="EMail/Error/ClientError.html">ClientError</a>
      
    </li>
  
  <li class=" " data-id="email/EMail/Error/ContentError" data-name="email::error::contenterror">
      <a href="EMail/Error/ContentError.html">ContentError</a>
      
    </li>
  
  <li class=" " data-id="email/EMail/Error/HeaderError" data-name="email::error::headererror">
      <a href="EMail/Error/HeaderError.html">HeaderError</a>
      
    </li>
  
  <li class=" " data-id="email/EMail/Error/MessageError" data-name="email::error::messageerror">
      <a href="EMail/Error/MessageError.html">MessageError</a>
      
    </li>
  
  <li class=" " data-id="email/EMail/Error/SenderError" data-name="email::error::sendererror">
      <a href="EMail/Error/SenderError.html">SenderError</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="email/EMail/Message" data-name="email::message">
      <a href="EMail/Message.html">Message</a>
      
    </li>
  
  <li class=" " data-id="email/EMail/Sender" data-name="email::sender">
      <a href="EMail/Sender.html">Sender</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1><a id="e-mail-for-crystal" class="anchor" href="#e-mail-for-crystal">  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>EMail for Crystal</h1>
<p><a href="https://travis-ci.org/arcage/crystal-email"><img src="https://travis-ci.org/arcage/crystal-email.svg?branch=master" alt="Build Status" /></a></p>
<p>Simple email sending library for the <a href="https://crystal-lang.org">Crystal programming language</a>.</p>
<p>You can:</p>
<ul>
<li>construct an email with a plain text message, a HTML message and/or some attachment files.</li>
<li>include resources(e.g. images) used in the HTML message.</li>
<li>set multiple recipients to the email.</li>
<li>use multibyte characters(only UTF-8) in the email.</li>
<li>send the email by using local or remote SMTP server.</li>
<li>use TLS connection by <strong>SMTP orver SSL/TLS</strong>(new) or <code>STARTTLS</code> command.</li>
<li>use SMTP-AUTH by <code>AUTH PLAIN</code> or <code>AUTH LOGIN</code> when using TLS.</li>
<li>send multiple emails concurrently by using multiple smtp connections.</li>
</ul>
<p>You can not:</p>
<ul>
<li>use ESMTP features except those mentioned above.</li>
</ul>
<h2><a id="installation" class="anchor" href="#installation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Installation</h2>
<p>First, add the dependency to your <code>shard.yml</code>:</p>
<pre><code class="language-yaml">dependencies:
  email:
    github: arcage/crystal-email</code></pre>
<p>Then, run <code>shards install</code></p>
<h3><a id="library-requirement" class="anchor" href="#library-requirement">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Library requirement</h3>
<p>When using STARTTLS or SMTPS, this shard require <strong>libssl</strong> and <strong>libcrypto</strong> for TLS handling.</p>
<p>You may have to install those libraries to your system.</p>
<h2><a id="usage" class="anchor" href="#usage">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Usage</h2>
<p>To send a minimal email message:</p>
<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;email&quot;</span>

<span class="c"># Create email message</span>
email <span class="o">=</span> <span class="t">EMail</span><span class="t">::</span><span class="t">Message</span>.<span class="k">new</span>
email.from    <span class="s">&quot;your_addr@example.com&quot;</span>
email.to      <span class="s">&quot;to@example.com&quot;</span>
email.subject <span class="s">&quot;Subject of the mail&quot;</span>
email.message <span class="s">&lt;&lt;-EOM</span>
<span class="s">  Message body of the mail.

  --
  Your Signature
  EOM</span>

<span class="c"># Set SMTP client configuration</span>
config <span class="o">=</span> <span class="t">EMail</span><span class="t">::</span><span class="t">Client</span><span class="t">::</span><span class="t">Config</span>.<span class="k">new</span>(<span class="s">&quot;your.mx.example.com&quot;</span>, <span class="n">25</span>)

<span class="c"># Create SMTP client object</span>
client <span class="o">=</span> <span class="t">EMail</span><span class="t">::</span><span class="t">Client</span>.<span class="k">new</span>(config)

client.start <span class="k">do</span>
  <span class="c"># In this block, default receiver is client</span>
  send(email)
<span class="k">end</span></code></pre>
<p>This code will output log entries to <code>STDOUT</code> as follows:</p>
<pre><code class="language-text">2018/01/25 20:35:09 [e_mail.client/12347] INFO [EMail_Client] Start TCP session to your.mx.example.com:25
2018/01/25 20:35:10 [e_mail.client/12347] INFO [EMail_Client] Successfully sent a message from &lt;your_addr@example.com&gt; to 1 recipient(s)
2018/01/25 20:35:10 [e_mail.client/12347] INFO [EMail_Client] Close TCP session to your.mx.example.com:25</code></pre>
<h3><a id="client-configs" class="anchor" href="#client-configs">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Client configs</h3>
<p>You can set some connection settings to <code><a href="EMail/Client/Config.html">EMail::Client::Config</a></code> object.</p>
<p>That can make SMTP connection to use TLS / SMTP AUTH, or output more detailed log message.</p>
<p>See <a href="https://www.denchu.org/crystal-email/EMail/Client/Config.html">EMail::Client::Config</a> for more details.</p>
<h3><a id="email-message" class="anchor" href="#email-message">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Email message</h3>
<p>You can set more email headers to <code><a href="EMail/Message.html">EMail::Message</a></code> object.</p>
<p>And, you can also send emails including attachment files, HTML message, and/or resource files related message body(e.g. image file for HTML message).</p>
<p>See <a href="https://www.denchu.org/crystal-email/EMail/Message.html">EMail::Message</a> for more details.</p>
<h3><a id="concurrent-sending" class="anchor" href="#concurrent-sending">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Concurrent sending</h3>
<p><strong>Note: this feature supports the <em>concurrent</em>(not parallel) sending with only one thread.</strong></p>
<p>By using <code><a href="EMail/ConcurrentSender.html">EMail::ConcurrentSender</a></code> object, you can concurrently send multiple messages by multiple connections.</p>
<pre><code class="language-crystal">rcpt_list <span class="o">=</span> [<span class="s">&quot;a@example.com&quot;</span>, <span class="s">&quot;b@example.com&quot;</span>, <span class="s">&quot;c@example.com&quot;</span>, <span class="s">&quot;d@example.com&quot;</span>]

<span class="c"># Set SMTP client configuration</span>
config <span class="o">=</span> <span class="t">EMail</span><span class="t">::</span><span class="t">Client</span><span class="t">::</span><span class="t">Config</span>.<span class="k">new</span>(<span class="s">&quot;your.mx.example.com&quot;</span>, <span class="n">25</span>)

<span class="c"># Create concurrent sender object</span>
sender <span class="o">=</span> <span class="t">EMail</span><span class="t">::</span><span class="t">ConcurrentSender</span>.<span class="k">new</span>(config)

<span class="c"># Sending emails with concurrently 3 connections.</span>
sender.number_of_connections <span class="o">=</span> <span class="n">3</span>

<span class="c"># Sending max 10 emails by 1 connection.</span>
sender.messages_per_connection <span class="o">=</span> <span class="n">10</span>

<span class="c"># Start email sending.</span>
sender.start <span class="k">do</span>
  <span class="c"># In this block, default receiver is sender</span>
  rcpts_list.each <span class="k">do</span> <span class="o">|</span>rcpt_to<span class="o">|</span>
    <span class="c"># Create email message</span>
    mail <span class="o">=</span> <span class="t">EMail</span><span class="t">::</span><span class="t">Message</span>.<span class="k">new</span>
    mail.from <span class="s">&quot;your_addr@example.com&quot;</span>
    mail.to rcpt_to
    mail.subject <span class="s">&quot;Concurrent email sending&quot;</span>
    mail.message <span class="s">&quot;message to </span><span class="i">#{</span>rcpt_to<span class="i">}</span><span class="s">&quot;</span>
    <span class="c"># Enqueue the email to sender</span>
    enqueue mail
  <span class="k">end</span>
<span class="k">end</span></code></pre>
<p>See <a href="https://www.denchu.org/crystal-email/EMail/ConcurrentSender.html">EMail::ConcurrentSender</a> for more details.</p>
<h2><a id="logging" class="anchor" href="#logging">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Logging</h2>
<p>The v0.34.0 of Crystal language has drastic changes in the logging functions. To fit it, the v0.5.0 of this shard also changes the logging behaviour.</p>
<p>You can use two kinds of logger(<code>Log</code> type object), the <strong>default logger</strong> and the <strong>client specific logger</strong>.</p>
<p>The <strong>default logger</strong> is declered on the <code><a href="EMail/Client.html">EMail::Client</a></code> type. It can be got by <code>EMail::Client.log</code>, and change its behavior by <code>EMail::Client.log_***=</code> methods.</p>
<p>On the other hand, the <strong>client specific logger</strong> will be set to <code><a href="EMail/Client.html">EMail::Client</a></code> instance itself by <code><a href="EMail/Client/Config.html">EMail::Client::Config</a></code> setting. With this, you can use your own logger for the <code><a href="EMail/Client.html">EMail::Client</a></code> object.</p>
<p>If the <code><a href="EMail/Client.html">EMail::Client</a></code> object has the <strong>client specific logger</strong>, the client use it to output the log entries. Otherwise, the client use the <strong>default logger</strong>.</p>
<p>See <a href="https://www.denchu.org/crystal-email/EMail/Client.html">EMail::Client</a> and <a href="https://www.denchu.org/crystal-email/EMail/Client/Config.html">EMail::Client::Config</a> for more details.</p>
<h3><a id="debug-log" class="anchor" href="#debug-log">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Debug log</h3>
<p>When you set the log level to <code>Log::Severity::Debug</code>, you can see all of the SMTP commands and the resposes in the log entries.</p>
<pre><code class="language-crystal"><span class="t">EMail</span><span class="t">::</span><span class="t">Client</span>.log_level <span class="o">=</span> <span class="t">Log</span><span class="t">::</span><span class="t">Severity</span><span class="t">::</span><span class="t">Debug</span></code></pre>
<p>Debug log are very useful to check how SMTP session works.</p>
<p>But, in the case of using SMTP AUTH, the debug log includes Base64 encoded user ID and passowrd. You should remenber that anyone can decode the authentication information from the debug log. And, you should use that <strong>very carefully</strong>.</p>
<h2><a id="owner" class="anchor" href="#owner">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Owner</h2>
<ul>
<li><a href="https://github.com/arcage">arcage</a> ʕ·ᴥ·ʔAKJ - creator, maintainer</li>
</ul>
<h2><a id="contributors" class="anchor" href="#contributors">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributors</h2>
<p>Thank you for valuable contributions.</p>
<ul>
<li><a href="https://github.com/arcage/crystal-email/graphs/contributors">Contributors</a></li>
</ul>
</div>
</body>
</html>
